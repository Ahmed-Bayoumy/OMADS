<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OMADS.POLL &mdash; Read the Docs OMADS 1.6.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/proof.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/proof.css" type="text/css" />
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/proof.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js"></script>
        <script src="../../_static/debug.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Read the Docs OMADS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Technical Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../benchmarking.html">Benchmarking</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Demo Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../OMADS.html">OMADS package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indicesAndTables.html">Indices and tables</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Read the Docs OMADS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>OMADS.POLL</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for OMADS.POLL</h1><div class="highlight"><pre>
<span></span>
<span class="c1"># ------------------------------------------------------------------------------------#</span>
<span class="c1">#  Mesh Adaptive Direct Search - ORTHO-MADS (MADS)                                    #</span>
<span class="c1">#                                                                                     #</span>
<span class="c1">#  Author: Ahmed H. Bayoumy                                                           #</span>
<span class="c1">#  email: ahmed.bayoumy@mail.mcgill.ca                                                #</span>
<span class="c1">#                                                                                     #</span>
<span class="c1">#  This program is free software: you can redistribute it and/or modify it under the  #</span>
<span class="c1">#  terms of the GNU Lesser General Public License as published by the Free Software   #</span>
<span class="c1">#  Foundation, either version 3 of the License, or (at your option) any later         #</span>
<span class="c1">#  version.                                                                           #</span>
<span class="c1">#                                                                                     #</span>
<span class="c1">#  This program is distributed in the hope that it will be useful, but WITHOUT ANY    #</span>
<span class="c1">#  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A    #</span>
<span class="c1">#  PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more details.   #</span>
<span class="c1">#                                                                                     #</span>
<span class="c1">#  You should have received a copy of the GNU Lesser General Public License along     #</span>
<span class="c1">#  with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.                     #</span>
<span class="c1">#                                                                                     #</span>
<span class="c1">#  You can find information on OMADS at                                               #</span>
<span class="c1">#  https://github.com/Ahmed-Bayoumy/OMADS                                             #</span>
<span class="c1">#  Copyright (C) 2022  Ahmed H. Bayoumy                                               #</span>
<span class="c1"># ------------------------------------------------------------------------------------#</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  This is a python implementation of the orothognal mesh adaptive direct search method (OMADS)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">signature</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">freeze_support</span><span class="p">,</span> <span class="n">cpu_count</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">concurrent.futures</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">BMDFO</span> <span class="kn">import</span> <span class="n">toy</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="nb">sum</span><span class="p">,</span> <span class="n">subtract</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">minimum</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">inf</span>


<div class="viewcode-block" id="DType"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.DType">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DType</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;A numpy data type delegator for decimal precision control</span>

<span class="sd">    :param prec: Default precision option can be set to &quot;high&quot;, &quot;medium&quot; or &quot;low&quot; precision resolution, defaults to &quot;medium&quot;</span>
<span class="sd">    :type prec: str, optional</span>
<span class="sd">    :param dtype: Numpy double data type precision, defaults to np.float64</span>
<span class="sd">    :type dtype: np.dtype, optional</span>
<span class="sd">    :param itype: Numpy integer data type precision, defaults to np.int</span>
<span class="sd">    :type itype: np.dtype, optional</span>
<span class="sd">    :param zero: Zero value resolution, defaults to np.finfo(np.float64).resolution</span>
<span class="sd">    :type zero: float, optional</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_prec</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medium&quot;</span>
  <span class="n">_dtype</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
  <span class="n">_itype</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int_</span>
  <span class="n">_zero</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">resolution</span>
  <span class="n">_warned</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>


  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">zero</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This is the mantissa value of the machine zero</span>

<span class="sd">    :return: machine precision zero resolution</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zero</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">precision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set/get precision resolution level</span>

<span class="sd">    :return: float precision value</span>
<span class="sd">    :rtype: numpy float</span>
<span class="sd">    :note: MS Windows does not support precision with the {1e-18} high resolution of the python</span>
<span class="sd">            numerical library (numpy) so high precision will be</span>
<span class="sd">            changed to medium precision which supports {1e-15} resolution</span>
<span class="sd">            check: https://numpy.org/doc/stable/user/basics.types.html </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prec</span>

  <span class="nd">@precision</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">precision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_prec</span> <span class="o">=</span> <span class="n">val</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_prec</span> <span class="o">=</span> <span class="n">val</span>
    <span class="n">isWin</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">platform</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Windows&#39;</span>
    <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;high&quot;</span><span class="p">:</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">isWin</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="s1">&#39;float128&#39;</span><span class="p">)):</span>
        <span class="c1"># COMPLETE: pop up this warning during initialization</span>
        <span class="s1">&#39;Warning: MS Windows does not support precision with the {1e-18} high resolution of the python numerical library (numpy) so high precision will be changed to medium precision which supports {1e-15} resolution check: https://numpy.org/doc/stable/user/basics.types.html &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">resolution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int_</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_warned</span><span class="p">:</span>
          <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;MS Windows does not support precision with the {1e-18} high resolution of the python numerical library (numpy) so high precision will be changed to medium precision which supports {1e-15} resolution check: https://numpy.org/doc/stable/user/basics.types.html&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warned</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float128</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float128</span><span class="p">)</span><span class="o">.</span><span class="n">resolution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int_</span>
    <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;medium&quot;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">resolution</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">itype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intc</span>
    <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;low&quot;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">resolution</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">itype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">short</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;JASON parameters file; unrecognized textual&quot;</span>
              <span class="s2">&quot; input for the defined precision type. &quot;</span>
              <span class="s2">&quot;Please enter one of these textual values (high, medium, low)&quot;</span><span class="p">)</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set/get the double formate type</span>

<span class="sd">    :return: float precision value</span>
<span class="sd">    :rtype: numpy float </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span>

  <span class="nd">@dtype</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">itype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set/Get for the integer formate type</span>

<span class="sd">    :return: integer precision value</span>
<span class="sd">    :rtype: numpy float </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_itype</span>

  <span class="nd">@itype</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">itype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_itype</span> <span class="o">=</span> <span class="n">other</span></div>


<div class="viewcode-block" id="Options"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Options">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Options</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot; The running study and algorithmic options of OMADS</span>
<span class="sd">  </span>
<span class="sd">    :param seed: Random generator seed</span>
<span class="sd">    :param budget: The evaluation budget</span>
<span class="sd">    :param tol: The threshold of the minimum poll size at which the run will be terminated</span>
<span class="sd">    :param psize_init: Initial poll size</span>
<span class="sd">    :param dispaly: Print the study progress during the run</span>
<span class="sd">    :param opportunistic: Loop on the points populated in the poll set until a better minimum found, then stop the evaluation loop</span>
<span class="sd">    :param check_cache: Check the hash table before points evaluation to avoid duplicates</span>
<span class="sd">    :param store_cache: Enable storing evaluated points into the hash table</span>
<span class="sd">    :param collect_y: Collect dependent design variables (required for DMDO)</span>
<span class="sd">    :param rich_direction: Go with the rich direction (Impact the mesh size update)</span>
<span class="sd">    :param precision: Define the precision level</span>
<span class="sd">    :param save_results: A boolean flag that indicates saving results in a csv file</span>
<span class="sd">    :param save_coordinates: A boolean flag that indicates saving coordinates of the poll set in a JSON file (required to generate animations of the spinner)</span>
<span class="sd">    :param save_all_best: A boolean used to check whether saving best points only in the MADS.out file</span>
<span class="sd">    :param parallel_mode: A boolean to check whether evaluating the poll set in parallel multiprocessing</span>
<span class="sd">    :param np: The number of CPUs</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">budget</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>
  <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-9</span>
  <span class="n">psize_init</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
  <span class="n">display</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">opportunistic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">check_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">store_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">collect_y</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">rich_direction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">precision</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;high&quot;</span>
  <span class="n">save_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">save_coordinates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">save_all_best</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">parallel_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">np</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></div>



<div class="viewcode-block" id="Parameters"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Parameters">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Parameters</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot; Variables and algorithmic parameters </span>
<span class="sd">  </span>
<span class="sd">    :param baseline: Baseline design point (initial point ``x0``)</span>
<span class="sd">    :param lb: The variables lower bound</span>
<span class="sd">    :param ub: The variables upper bound</span>
<span class="sd">    :param var_names: The variables name</span>
<span class="sd">    :param scaling: Scaling factor (can be defined as a list (assigning a factor for each variable) or a scalar value that will be applied on all variables)</span>
<span class="sd">    :param post_dir: The location and name of the post directory where the output results file will live in (if any)</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">baseline</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
  <span class="n">lb</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">])</span>
  <span class="n">ub</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">])</span>
  <span class="n">var_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;x1&quot;</span><span class="p">,</span> <span class="s2">&quot;x2&quot;</span><span class="p">])</span>
  <span class="n">scaling</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span>
  <span class="n">post_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;.</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span></div>
  <span class="c1"># TODO: support more variable types</span>
  <span class="c1"># TODO: give better control on variabls&#39; resolution (mesh granularity)</span>
  <span class="c1"># var_type: List[str] = field(default_factory=[&quot;cont&quot;, &quot;cont&quot;])</span>
  <span class="c1"># resolution: List[int] = field(default_factory=[&quot;cont&quot;, &quot;cont&quot;])</span>


<div class="viewcode-block" id="Evaluator"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Evaluator">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Evaluator</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot; Define the evaluator attributes and settings</span>
<span class="sd">  </span>
<span class="sd">    :param blackbox: The blackbox name (it can be a callable function or an executable file)</span>
<span class="sd">    :param commandOptions: Define options that will be added to the execution command of the executable file. Command options should be defined as a string in one line</span>
<span class="sd">    :param internal: If the blackbox callable function is part of the internal benchmarking library</span>
<span class="sd">    :param path: The path of the executable file (if any) </span>
<span class="sd">    :param input: The input file name -- should include the file extension</span>
<span class="sd">    :param output: The output file name -- should include the file extension </span>
<span class="sd">    :param constants: Define constant parameters list, see the documentation in Tutorials-&gt;Blackbox evaluation-&gt;User parameters</span>
<span class="sd">    :param _dtype: The precision delegator of the numpy library</span>
<span class="sd">    :param timeout: The time out of the evaluation process</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">blackbox</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="s2">&quot;rosenbrock&quot;</span>
  <span class="n">commandOptions</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">internal</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;..</span><span class="se">\\</span><span class="s2">tests</span><span class="se">\\</span><span class="s2">Rosen&quot;</span>
  <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;input.inp&quot;</span>
  <span class="n">output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;output.out&quot;</span>
  <span class="n">constants</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">bb_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">_dtype</span><span class="p">:</span> <span class="n">DType</span> <span class="o">=</span> <span class="n">DType</span><span class="p">()</span>
  <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1000000.</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span>

<div class="viewcode-block" id="Evaluator.eval"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Evaluator.eval">[docs]</a>  <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot; Evaluate the poll point</span>

<span class="sd">    :param values: Poll point coordinates (design vector)</span>
<span class="sd">    :type values: List[float]</span>
<span class="sd">    :raises IOError: Incorrect number of input arguments introduced to the callable function</span>
<span class="sd">    :raises IOError: Incorrect number of input arguments introduced to the callable function</span>
<span class="sd">    :raises IOError: The blackbox file is not an executable file (if not a callable function)</span>
<span class="sd">    :raises IOError: Incorrect benchmarking keyword category</span>
<span class="sd">    :return: Evaluated optimization functions</span>
<span class="sd">    :rtype: List[float, List[float]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bb_eval</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blackbox</span><span class="p">):</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">signature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blackbox</span><span class="p">)</span>
        <span class="n">npar</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> 
        <span class="c1"># Get input arguments defined for the callable </span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="c1"># Check if user constants list is defined and if the number of input args of the callable matches what OMADS expects </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constants</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">npar</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="p">(</span><span class="n">npar</span><span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">npar</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;*argv&#39;</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">))):</span>
            <span class="k">try</span><span class="p">:</span>
              <span class="n">f_eval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blackbox</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
              <span class="n">evalerr</span> <span class="o">=</span> <span class="kc">True</span>
              <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Callable </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blackbox</span><span class="p">)</span><span class="si">}</span><span class="s2"> evaluation returned an error at the poll point </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The callable </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blackbox</span><span class="p">)</span><span class="si">}</span><span class="s1"> requires </span><span class="si">{</span><span class="n">npar</span><span class="si">}</span><span class="s1"> input args, but only one input can be provided! You can introduce other input parameters to the callable function using the constants list.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">npar</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="p">(</span><span class="n">npar</span><span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">npar</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;*argv&#39;</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">))):</span>
            <span class="k">try</span><span class="p">:</span>
              <span class="n">f_eval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blackbox</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">constants</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
              <span class="n">evalerr</span> <span class="o">=</span> <span class="kc">True</span>
              <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Callable </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blackbox</span><span class="p">)</span><span class="si">}</span><span class="s2"> evaluation returned an error at the poll point </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The callable </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blackbox</span><span class="p">)</span><span class="si">}</span><span class="s1"> requires </span><span class="si">{</span><span class="n">npar</span><span class="si">}</span><span class="s1"> input args, but only two input args can be provided as the constants list is defined!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f_eval</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
          <span class="k">return</span> <span class="n">f_eval</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f_eval</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f_eval</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
          <span class="k">return</span> <span class="p">[</span><span class="n">f_eval</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_input</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">pwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">isWin</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">platform</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Windows&#39;</span>
        <span class="n">evalerr</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">timouterr</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#  Check if the file is executable</span>
        <span class="n">executable</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blackbox</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">X_OK</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">executable</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The blackbox file </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blackbox</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not an executable! Please provide a valid executable file.&quot;</span><span class="p">)</span>
        <span class="c1"># Prepare the execution command based on the running machine&#39;s OS</span>
        <span class="k">if</span> <span class="n">isWin</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">commandOptions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
          <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blackbox</span>
        <span class="k">elif</span> <span class="n">isWin</span><span class="p">:</span>
          <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">blackbox</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">commandOptions</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">commandOptions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
          <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;./</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">blackbox</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">cmd</span> <span class="o">=</span>  <span class="sa">f</span><span class="s1">&#39;./</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">blackbox</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">commandOptions</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">try</span><span class="p">:</span>
          <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
          <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">evalerr</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Evaluation # </span><span class="si">{self.bb_eval}</span><span class="s2"> is errored at the poll point </span><span class="si">{values}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
          <span class="n">timouterr</span> <span class="o">=</span> <span class="kc">True</span> 
          <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Timeout for </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="si">}</span><span class="s1">s) expired at evaluation # </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bb_eval</span><span class="si">}</span><span class="s1"> at the poll point </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">evalerr</span> <span class="ow">or</span> <span class="n">timouterr</span><span class="p">:</span>
          <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">read_output</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">read_output</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]]]</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal</span> <span class="o">==</span> <span class="s2">&quot;uncon&quot;</span><span class="p">:</span>
      <span class="n">f_eval</span> <span class="o">=</span> <span class="n">toy</span><span class="o">.</span><span class="n">UnconSO</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal</span> <span class="o">==</span> <span class="s2">&quot;con&quot;</span><span class="p">:</span>
      <span class="n">f_eval</span> <span class="o">=</span> <span class="n">toy</span><span class="o">.</span><span class="n">ConSO</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input dict:: evaluator:: internal:: &quot;</span>
              <span class="sa">f</span><span class="s2">&quot;Incorrect internal method :: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">internal</span><span class="si">}</span><span class="s2"> :: &quot;</span>
              <span class="sa">f</span><span class="s2">&quot;it should be a a BM library name, &quot;</span>
              <span class="sa">f</span><span class="s2">&quot;or None.&quot;</span><span class="p">)</span>
    <span class="n">f_eval</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span>
    <span class="n">f_eval</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blackbox</span>
    <span class="n">f_eval</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f_eval</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">blackbox</span><span class="p">)()</span></div>

<div class="viewcode-block" id="Evaluator.write_input"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Evaluator.write_input">[docs]</a>  <span class="k">def</span> <span class="nf">write_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">    :param values: Write the variables in the input file</span>
<span class="sd">    :type values: List[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
          <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Evaluator.read_output"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Evaluator.read_output">[docs]</a>  <span class="k">def</span> <span class="nf">read_output</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">    :return: Read the output values from the output file </span>
<span class="sd">    :rtype: List[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
    <span class="n">f_eval</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># read rest of lines</span>
      <span class="n">f_eval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f_eval</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">f_eval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f_eval</span></div></div>


<div class="viewcode-block" id="Point"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Point">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot; A class for the poll point</span>
<span class="sd">    </span>
<span class="sd">    :param _n: # Dimension of the point</span>
<span class="sd">    :param _coords: Coordinates of the point</span>
<span class="sd">    :param _defined: Coordinates definition boolean</span>
<span class="sd">    :param _evaluated: Evaluation boolean</span>
<span class="sd">    :param _f: Objective function</span>
<span class="sd">    :param _freal: Realistic target value of the objective function</span>
<span class="sd">    :param _c_ineq: Inequality constraints</span>
<span class="sd">    :param _c_eq: Equality constraints</span>
<span class="sd">    :param _h: Aggregated constraints; active set</span>
<span class="sd">    :param _signature: hash signature; facilitate looking for duplicates and storing coordinates, hash signature, in the cache memory</span>
<span class="sd">    :param _dtype:  numpy double data type precision</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1"># Dimension of the point</span>
  <span class="n">_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="c1"># Coordinates of the point</span>
  <span class="n">_coords</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
  <span class="c1"># Coordinates definition boolean</span>
  <span class="n">_defined</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">])</span>
  <span class="c1"># Evaluation boolean</span>
  <span class="n">_evaluated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="c1"># Objective function</span>
  <span class="n">_f</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">inf</span>
  <span class="n">_freal</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">inf</span>
  <span class="c1"># Inequality constraints</span>
  <span class="n">_c_ineq</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
  <span class="c1"># Equality constraints</span>
  <span class="n">_c_eq</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
  <span class="c1"># Aggregated constraints; active set</span>
  <span class="n">_h</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">inf</span>
  <span class="c1"># hash signature; facilitate looking for duplicates and storing coordinates,</span>
  <span class="c1"># hash signature, in the cache memory</span>
  <span class="n">_signature</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="c1"># numpy double data type precision</span>
  <span class="n">_dtype</span><span class="p">:</span> <span class="n">DType</span> <span class="o">=</span> <span class="n">DType</span><span class="p">()</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span>

  <span class="nd">@dtype</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">DType</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">evaluated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluated</span>

  <span class="nd">@evaluated</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">evaluated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_evaluated</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">signature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signature</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">n_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n</span>

  <span class="nd">@n_dimensions</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">n_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_dimensions</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defined</span><span class="p">:</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">defined</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_n</span> <span class="o">=</span> <span class="n">n</span>

  <span class="nd">@n_dimensions</span><span class="o">.</span><span class="n">deleter</span>
  <span class="k">def</span> <span class="nf">n_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_n</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the coordinates of the point.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span>

  <span class="nd">@coordinates</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot; Get the coordinates of the point. &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_signature</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_defined</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n</span>

  <span class="nd">@coordinates</span><span class="o">.</span><span class="n">deleter</span>
  <span class="k">def</span> <span class="nf">coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">defined</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defined</span>

  <span class="nd">@defined</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">defined</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_defined</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

  <span class="nd">@defined</span><span class="o">.</span><span class="n">deleter</span>
  <span class="k">def</span> <span class="nf">defined</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defined</span>

<div class="viewcode-block" id="Point.is_any_defined"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Point.is_any_defined">[docs]</a>  <span class="k">def</span> <span class="nf">is_any_defined</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Check if at least one coordinate is defined.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_dimensions</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defined</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="kc">False</span></div>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f</span>

  <span class="nd">@f</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_f</span> <span class="o">=</span> <span class="n">val</span>

  <span class="nd">@f</span><span class="o">.</span><span class="n">deleter</span>
  <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">freal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_freal</span>

  <span class="nd">@freal</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">freal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_freal</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">c_ineq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_ineq</span>

  <span class="nd">@c_ineq</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">c_ineq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vals</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_c_ineq</span> <span class="o">=</span> <span class="n">vals</span>

  <span class="nd">@c_ineq</span><span class="o">.</span><span class="n">deleter</span>
  <span class="k">def</span> <span class="nf">c_ineq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_ineq</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">c_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_eq</span>

  <span class="nd">@c_eq</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">c_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_c_eq</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h</span>

  <span class="nd">@h</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_h</span> <span class="o">=</span> <span class="n">val</span>

  <span class="nd">@h</span><span class="o">.</span><span class="n">deleter</span>
  <span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h</span>

<div class="viewcode-block" id="Point.reset"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Point.reset">[docs]</a>  <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Sets all coordinates to d. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_n</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n</span> <span class="o">!=</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_dimensions</span> <span class="o">=</span> <span class="n">n</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span> <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span></div>

  <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_dimensions</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="n">n_dimensions</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">coordinates</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> \
         <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_any_defined</span><span class="p">()</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="n">is_any_defined</span><span class="p">()</span> \
         <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="n">f</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="n">h</span>

  <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">h</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">zero</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dh__</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">other</span><span class="p">))</span> <span class="ow">or</span> \
         <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">zero</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__df__</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">other</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>

  <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq_f__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">f</span>

  <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__lt__</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">other</span><span class="p">)</span>

  <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="si">}</span><span class="s1">&#39;</span>

  <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="n">dcoord</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_dimensions</span><span class="p">):</span>
      <span class="n">dcoord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subtract</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                   <span class="n">other</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">dcoord</span>

  <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="n">dcoord</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_dimensions</span><span class="p">):</span>
      <span class="n">dcoord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">other</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">dcoord</span>

  <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__dominate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; x dominates y, if f(x)&lt; f(y) &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__le__</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>

  <span class="k">def</span> <span class="nf">__eval__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bb_output</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Evaluate point &quot;&quot;&quot;</span>
    <span class="sd">&quot;&quot;&quot; Objective function &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">bb_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">freal</span> <span class="o">=</span> <span class="n">bb_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="sd">&quot;&quot;&quot; Inequality constraints (can be an empty vector) &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">c_ineq</span> <span class="o">=</span> <span class="n">bb_output</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="sd">&quot;&quot;&quot; Aggregate constraints &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">power</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c_ineq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">zero</span><span class="p">,</span>
                   <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c_ineq</span><span class="p">)):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">inf</span>
    <span class="sd">&quot;&quot;&quot; Penalize the objective &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">zero</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">__penalize__</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">__penalize__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">inf</span>

  <span class="k">def</span> <span class="nf">__is_duplicate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">signature</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signature</span>

  <span class="k">def</span> <span class="nf">__eq_f__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df__</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">other</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">zero</span>

  <span class="k">def</span> <span class="nf">__eq_h__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dh__</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">other</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">zero</span>

  <span class="k">def</span> <span class="nf">__df__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">subtract</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__dh__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">subtract</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span></div>


<div class="viewcode-block" id="OrthoMesh"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.OrthoMesh">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">OrthoMesh</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot; Mesh coarsness update class</span>

<span class="sd">  :param _delta: mesh size</span>
<span class="sd">  :param _Delta: poll size</span>
<span class="sd">  :param _rho: poll size to mesh size ratio</span>
<span class="sd">  :param _exp:  manage the poll size granularity for discrete variables. See Audet et. al, The mesh adaptive direct search algorithm for granular and discrete variable</span>
<span class="sd">  :param _mantissa: Same as ``_exp``</span>
<span class="sd">  :param psize_max: Maximum poll size</span>
<span class="sd">  :param psize_success: Poll size at successful evaluation</span>
<span class="sd">  :param _dtype: numpy double data type precision</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_delta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>  <span class="c1"># mesh size</span>
  <span class="n">_Delta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>  <span class="c1"># poll size</span>
  <span class="n">_rho</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>  <span class="c1"># poll size to mesh size ratio</span>
  <span class="c1"># TODO: manage the poll size granularity for discrete variables</span>
  <span class="c1"># See: Audet et. al, The mesh adaptive direct search algorithm for</span>
  <span class="c1"># granular and discrete variable</span>
  <span class="n">_exp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">_mantissa</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">psize_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
  <span class="n">psize_success</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
  <span class="c1"># numpy double data type precision</span>
  <span class="n">_dtype</span><span class="p">:</span> <span class="n">DType</span> <span class="o">=</span> <span class="n">DType</span><span class="p">()</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span>

  <span class="nd">@dtype</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">DType</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">msize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span>

  <span class="nd">@msize</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">msize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span> <span class="o">=</span> <span class="n">size</span>

  <span class="nd">@msize</span><span class="o">.</span><span class="n">deleter</span>
  <span class="k">def</span> <span class="nf">msize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">psize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Delta</span>

  <span class="nd">@psize</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">psize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_Delta</span> <span class="o">=</span> <span class="n">size</span>

  <span class="nd">@psize</span><span class="o">.</span><span class="n">deleter</span>
  <span class="k">def</span> <span class="nf">psize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Delta</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">rho</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rho</span>

  <span class="nd">@rho</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">rho</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rho</span> <span class="o">=</span> <span class="n">size</span>

  <span class="nd">@rho</span><span class="o">.</span><span class="n">deleter</span>
  <span class="k">def</span> <span class="nf">rho</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rho</span>

<div class="viewcode-block" id="OrthoMesh.update"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.OrthoMesh.update">[docs]</a>  <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">msize</span> <span class="o">=</span> <span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Delta</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">_Delta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Delta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Cache"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Cache">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Cache</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot; In computing, a hash table (hash map) is a data structure that implements an associative array abstract data type, a structure that can map keys to values. A hash table uses a hash function to compute an index, also called a hash code, into an array of buckets or slots, from which the desired value can be found. During lookup, the key is hashed and the resulting hash indicates where the corresponding value is stored.&quot;&quot;&quot;</span>
  <span class="n">_hash_ID</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
  <span class="n">_cache_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">cache_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A getter of the cache memory dictionary</span>

<span class="sd">    :rtype: Dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dict</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">hash_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;A getter to return the list of hash IDs</span>

<span class="sd">    :rtype: List[int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_ID</span>

  <span class="nd">@hash_id</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">hash_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Point</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_hash_ID</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)))</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A getter of the size of the hash ID list</span>

<span class="sd">    :rtype: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_id</span><span class="p">)</span>

<div class="viewcode-block" id="Cache.is_duplicate"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Cache.is_duplicate">[docs]</a>  <span class="k">def</span> <span class="nf">is_duplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Check if the point is in the cache memory</span>

<span class="sd">    :param x: Design point</span>
<span class="sd">    :type x: Point</span>
<span class="sd">    :return: A boolean flag indicate whether the point exist in the cache memory</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">signature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_id</span></div>

<div class="viewcode-block" id="Cache.get_index"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Cache.get_index">[docs]</a>  <span class="k">def</span> <span class="nf">get_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get the index of hash value, associated with the point x, if that point was saved in the cach memory</span>

<span class="sd">    :param x: Input point</span>
<span class="sd">    :type x: Point</span>
<span class="sd">    :return: The index of the point in the hash ID list</span>
<span class="sd">    :rtype: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hash_value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">coordinates</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">hash_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_id</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_id</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">hash_value</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>

<div class="viewcode-block" id="Cache.add_to_cache"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Cache.add_to_cache">[docs]</a>  <span class="k">def</span> <span class="nf">add_to_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Point</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save the point x to the cache memory</span>

<span class="sd">    :param x: Evaluated point to be saved in the cache memory</span>
<span class="sd">    :type x: Point</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_duplicate</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
      <span class="n">hash_value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">coordinates</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dict</span><span class="p">[</span><span class="n">hash_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span></div></div>


<div class="viewcode-block" id="Dirs2n"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Dirs2n">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Dirs2n</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;This is the orthognal 2n-directions class used for the poll step</span>

<span class="sd">    :param _poll_dirs: Poll set (list of points)</span>
<span class="sd">    :param _point_index: List of point indices</span>
<span class="sd">    :param _n: Number of directions</span>
<span class="sd">    :param _defined: A boolean that indicate if the poll points are defined</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_poll_dirs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
  <span class="n">_point_index</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
  <span class="n">_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">_defined</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">])</span>
  <span class="n">scaling</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
  <span class="n">_xmin</span><span class="p">:</span> <span class="n">Point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
  <span class="n">_nb_success</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">_bb_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
  <span class="n">_psize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
  <span class="n">_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
  <span class="n">hashtable</span><span class="p">:</span> <span class="n">Cache</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Cache</span><span class="p">)</span>
  <span class="n">_check_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="n">_display</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="n">_store_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="n">_save_results</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="n">mesh</span><span class="p">:</span> <span class="n">OrthoMesh</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">OrthoMesh</span><span class="p">)</span>
  <span class="n">_opportunistic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">_eval_budget</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>
  <span class="n">_dtype</span><span class="p">:</span> <span class="n">DType</span> <span class="o">=</span> <span class="n">DType</span><span class="p">()</span>
  <span class="n">bb_handle</span><span class="p">:</span> <span class="n">Evaluator</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Evaluator</span><span class="p">)</span>
  <span class="n">_success</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">_terminate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">_bb_output</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">bb_output</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bb_output</span>

  <span class="nd">@bb_output</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">bb_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_bb_output</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span>

  <span class="nd">@dtype</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">DType</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">point_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_point_index</span>

  <span class="nd">@point_index</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">point_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">other</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_point_index</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_point_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">terminate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terminate</span>

  <span class="nd">@terminate</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">terminate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_terminate</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">seed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seed</span>

  <span class="nd">@seed</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_seed</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">success</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span>

  <span class="nd">@success</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">eval_budget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_budget</span>

  <span class="nd">@eval_budget</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">eval_budget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eval_budget</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">opportunistic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_opportunistic</span>

  <span class="nd">@opportunistic</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">opportunistic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_opportunistic</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">save_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_results</span>

  <span class="nd">@save_results</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">save_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_save_results</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">store_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_store_cache</span>

  <span class="nd">@store_cache</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">store_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_store_cache</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">check_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_cache</span>

  <span class="nd">@check_cache</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">check_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_cache</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_display</span>

  <span class="nd">@display</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_display</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">bb_eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bb_eval</span>

  <span class="nd">@bb_eval</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">bb_eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_bb_eval</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">psize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_psize</span>

  <span class="nd">@psize</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">psize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_psize</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">iter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span>

  <span class="nd">@iter</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">iter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">poll_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poll_dirs</span>

  <span class="nd">@poll_dirs</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">poll_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">Point</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_poll_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

  <span class="nd">@poll_dirs</span><span class="o">.</span><span class="n">deleter</span>
  <span class="k">def</span> <span class="nf">poll_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poll_dirs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_poll_dirs</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">dim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n</span>

  <span class="nd">@dim</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">dim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_n</span> <span class="o">=</span> <span class="n">n</span>

  <span class="nd">@dim</span><span class="o">.</span><span class="n">deleter</span>
  <span class="k">def</span> <span class="nf">dim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_n</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">defined</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_defined</span><span class="p">)</span>

  <span class="nd">@defined</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">defined</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defined</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_defined</span> <span class="o">=</span> <span class="n">defined</span>

  <span class="nd">@defined</span><span class="o">.</span><span class="n">deleter</span>
  <span class="k">def</span> <span class="nf">defined</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defined</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">xmin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xmin</span>

  <span class="nd">@xmin</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">xmin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Point</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_xmin</span> <span class="o">=</span> <span class="n">other</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">nb_success</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nb_success</span>

  <span class="nd">@nb_success</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">nb_success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_nb_success</span> <span class="o">=</span> <span class="n">other</span>

<div class="viewcode-block" id="Dirs2n.generate_dir"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Dirs2n.generate_dir">[docs]</a>  <span class="k">def</span> <span class="nf">generate_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>

<div class="viewcode-block" id="Dirs2n.ran"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Dirs2n.ran">[docs]</a>  <span class="k">def</span> <span class="nf">ran</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dirs2n.create_housholder"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Dirs2n.create_housholder">[docs]</a>  <span class="k">def</span> <span class="nf">create_housholder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_rich</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Create householder matrix</span>

<span class="sd">    :param is_rich:  A flag that indicates if the rich direction option is enabled</span>
<span class="sd">    :type is_rich: bool</span>
<span class="sd">    :return: The householder matrix</span>
<span class="sd">    :rtype: np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hhm</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="k">if</span> <span class="n">is_rich</span><span class="p">:</span>
      <span class="n">v_dir</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ran</span><span class="p">())</span>
      <span class="n">v_dir_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v_dir</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
      <span class="n">v_dir_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">v_dir_array</span><span class="p">,</span>
                  <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v_dir_array</span><span class="p">,</span>
                          <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)),</span>
                  <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
      <span class="n">hhm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">v_dir_array</span><span class="p">,</span> <span class="n">v_dir_array</span><span class="o">.</span><span class="n">T</span><span class="p">),</span>
                      <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
                <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">hhm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">hhm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">hhm</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hhm</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
    <span class="c1"># Rounding( and transpose)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">rho</span><span class="p">,</span> <span class="n">hhm</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">hhm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">msize</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">tmp</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
    <span class="n">hhm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">hhm</span><span class="p">,</span> <span class="o">-</span><span class="n">hhm</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">hhm</span></div>

<div class="viewcode-block" id="Dirs2n.create_poll_set"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Dirs2n.create_poll_set">[docs]</a>  <span class="k">def</span> <span class="nf">create_poll_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hhm</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ub</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">lb</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">it</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create the poll directions</span>

<span class="sd">    :param hhm: Householder matrix</span>
<span class="sd">    :type hhm: np.ndarray</span>
<span class="sd">    :param ub: Variables upper bound</span>
<span class="sd">    :type ub: List[float]</span>
<span class="sd">    :param lb: Variables lower bound</span>
<span class="sd">    :type lb: List[float]</span>
<span class="sd">    :param it: iteration</span>
<span class="sd">    :type it: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">poll_dirs</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hhm</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">coordinates</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="c1"># np.random.seed(self._seed)</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">):</span>
      <span class="n">tmp</span> <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
      <span class="n">tmp</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
      <span class="n">tmp</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">precision</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">poll_dirs</span> <span class="o">=</span> <span class="n">tmp</span>
      <span class="k">del</span> <span class="n">tmp</span>
    <span class="k">del</span> <span class="n">temp</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">iter</span> <span class="o">=</span> <span class="n">it</span></div>

<div class="viewcode-block" id="Dirs2n.scale"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Dirs2n.scale">[docs]</a>  <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ub</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">lb</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">subtract</span><span class="p">(</span><span class="n">ub</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
                 <span class="n">factor</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="p">)):</span>
      <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">x</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">s_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s_array</span><span class="p">)):</span>
      <span class="n">temp</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s_array</span><span class="p">[</span><span class="n">k</span><span class="p">])):</span>
        <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_array</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
      <span class="k">del</span> <span class="n">temp</span></div>

<div class="viewcode-block" id="Dirs2n.eval_poll_point"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Dirs2n.eval_poll_point">[docs]</a>  <span class="k">def</span> <span class="nf">eval_poll_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Evaluate the point i on the poll set &quot;&quot;&quot;</span>
    <span class="sd">&quot;&quot;&quot; Set the dynamic index for this point &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">point_index</span> <span class="o">=</span> <span class="n">index</span>
    <span class="sd">&quot;&quot;&quot; Initialize stopping and success conditions&quot;&quot;&quot;</span>
    <span class="n">stop</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="sd">&quot;&quot;&quot; Copy the point i to a trial one &quot;&quot;&quot;</span>
    <span class="n">xtry</span><span class="p">:</span> <span class="n">Point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poll_dirs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="sd">&quot;&quot;&quot; This is a success bool parameter used for</span>
<span class="sd">     filtering out successful designs to be printed</span>
<span class="sd">    in the output results file&quot;&quot;&quot;</span>
    <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="sd">&quot;&quot;&quot; Check the cache memory; check if the trial point</span>
<span class="sd">     is a duplicate (it has already been evaluated) &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_cache</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hashtable</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hashtable</span><span class="o">.</span><span class="n">is_duplicate</span><span class="p">(</span><span class="n">xtry</span><span class="p">)</span>
    <span class="p">):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cache hit ...&quot;</span><span class="p">)</span>
      <span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="n">bb_eval</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bb_eval</span><span class="p">)</span>
      <span class="n">psize</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">[</span><span class="n">stop</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bb_handle</span><span class="o">.</span><span class="n">bb_eval</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">psize</span><span class="p">,</span> <span class="n">xtry</span><span class="p">]</span>

    <span class="sd">&quot;&quot;&quot; Evaluation of the blackbox; get output responses &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bb_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bb_handle</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">xtry</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Evaluate the poll point:</span>
<span class="sd">        - Evaluate objective function</span>
<span class="sd">        - Evaluate constraint functions (can be an empty vector)</span>
<span class="sd">        - Aggregate constraints</span>
<span class="sd">        - Penalize the objective (extreme barrier)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xtry</span><span class="o">.</span><span class="n">__eval__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bb_output</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot; Add to the cache memory &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_cache</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">hashtable</span><span class="o">.</span><span class="n">hash_id</span> <span class="o">=</span> <span class="n">xtry</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_results</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bb_eval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bb_handle</span><span class="o">.</span><span class="n">bb_eval</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">psize</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize</span><span class="p">)</span>
      <span class="n">psize</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize</span><span class="p">)</span>



    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">opportunistic</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="sd">&quot;&quot;&quot; Check stopping criteria &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bb_eval</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_budget</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">terminate</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="k">return</span> <span class="p">[</span><span class="n">stop</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bb_handle</span><span class="o">.</span><span class="n">bb_eval</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">psize</span><span class="p">,</span> <span class="n">xtry</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">stop</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bb_handle</span><span class="o">.</span><span class="n">bb_eval</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">psize</span><span class="p">,</span> <span class="n">xtry</span><span class="p">]</span></div>

<div class="viewcode-block" id="Dirs2n.master_updates"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Dirs2n.master_updates">[docs]</a>  <span class="k">def</span> <span class="nf">master_updates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">peval</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">peval</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_budget</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">terminate</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">xtry</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
      <span class="sd">&quot;&quot;&quot; Check success conditions &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">xtry</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># &lt;- This redundant variable is important</span>
        <span class="c1"># for managing concurrent parallel execution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_success</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="sd">&quot;&quot;&quot; Update the post instant &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xmin</span> <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xmin</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">xtry</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
          <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Success: fmin = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">f</span><span class="si">:</span><span class="s2">.15f</span><span class="si">}</span><span class="s2"> (hmin = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">h</span><span class="si">:</span><span class="s2">.15</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
          <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Success: fmin = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">f</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> (hmin = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">h</span><span class="si">:</span><span class="s2">.6</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Success: fmin = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">f</span><span class="si">:</span><span class="s2">.18f</span><span class="si">}</span><span class="s2"> (hmin = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">h</span><span class="si">:</span><span class="s2">.18</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize_success</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize_max</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize_max</span><span class="p">,</span>
                              <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span></div></div>




<span class="c1"># TODO: More methods and parameters will be added to the</span>
<span class="c1">#  &#39;pre_mads&#39; class when OMADS is used for solving MDO</span>
<span class="c1">#  subproblems</span>
<div class="viewcode-block" id="PreMADS"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.PreMADS">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PreMADS</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot; Preprocessor for setting up optimization settings and parameters&quot;&quot;&quot;</span>
  <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>

<div class="viewcode-block" id="PreMADS.initialize_from_dict"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.PreMADS.initialize_from_dict">[docs]</a>  <span class="k">def</span> <span class="nf">initialize_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; MADS initialization &quot;&quot;&quot;</span>
    <span class="sd">&quot;&quot;&quot; 1- Construct the following classes by unpacking</span>
<span class="sd">     their respective dictionaries from the input JSON file &quot;&quot;&quot;</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">])</span>
    <span class="n">param</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;param&quot;</span><span class="p">])</span>
    <span class="n">ev</span> <span class="o">=</span> <span class="n">Evaluator</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;evaluator&quot;</span><span class="p">])</span>
    <span class="n">ev</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">precision</span>
    <span class="sd">&quot;&quot;&quot; 2- Initialize iteration number and construct a point instant for the starting point &quot;&quot;&quot;</span>
    <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">x_start</span> <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot; 3- Construct an instant for the poll 2n orthogonal directions class object &quot;&quot;&quot;</span>
    <span class="n">poll</span> <span class="o">=</span> <span class="n">Dirs2n</span><span class="p">()</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">precision</span>
    <span class="sd">&quot;&quot;&quot; 4- Construct an instant for the mesh subclass object by inheriting</span>
<span class="sd">     initial parameters from mesh_params() &quot;&quot;&quot;</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">OrthoMesh</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot; 5- Assign optional algorithmic parameters to the constructed poll instant  &quot;&quot;&quot;</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">opportunistic</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">opportunistic</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">seed</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">precision</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">psize_init</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">eval_budget</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">budget</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">store_cache</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">store_cache</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">check_cache</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">check_cache</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">display</span>
    <span class="n">n_available_cores</span> <span class="o">=</span> <span class="n">cpu_count</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">parallel_mode</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">np</span> <span class="o">&gt;</span> <span class="n">n_available_cores</span><span class="p">:</span>
      <span class="n">options</span><span class="o">.</span><span class="n">np</span> <span class="o">==</span> <span class="n">n_available_cores</span>
    <span class="sd">&quot;&quot;&quot; 6- Initialize blackbox handling subclass by copying</span>
<span class="sd">     the evaluator &#39;ev&#39; instance to the poll object&quot;&quot;&quot;</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">bb_handle</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot; 7- Evaluate the starting point &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Evaluation of the starting points&quot;</span><span class="p">)</span>
    <span class="n">x_start</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">baseline</span>
    <span class="n">x_start</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">precision</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">bb_output</span> <span class="o">=</span> <span class="n">poll</span><span class="o">.</span><span class="n">bb_handle</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">x_start</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>
    <span class="n">x_start</span><span class="o">.</span><span class="n">__eval__</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">bb_output</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot; 8- Copy the starting point object to the poll&#39;s  minimizer subclass &quot;&quot;&quot;</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">x_start</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot; 9- Hold the starting point in the poll</span>
<span class="sd">     directions subclass and define problem parameters&quot;&quot;&quot;</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">poll_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_start</span><span class="p">)</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">ub</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">ub</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">lb</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">scaling</span><span class="p">)</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">x_start</span><span class="o">.</span><span class="n">n_dimensions</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">hashtable</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot; 10- Initialize the number of successful points</span>
<span class="sd">     found and check if the starting minimizer performs better</span>
<span class="sd">    than the worst (f = inf) &quot;&quot;&quot;</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">nb_success</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">poll</span><span class="o">.</span><span class="n">xmin</span> <span class="o">&lt;</span> <span class="n">Point</span><span class="p">():</span>
      <span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize_success</span> <span class="o">=</span> <span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize</span>
      <span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize_max</span> <span class="o">=</span> <span class="n">maximum</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize</span><span class="p">,</span>
                      <span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize_max</span><span class="p">,</span>
                      <span class="n">dtype</span><span class="o">=</span><span class="n">poll</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
      <span class="n">poll</span><span class="o">.</span><span class="n">poll_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="p">]</span>
    <span class="sd">&quot;&quot;&quot; 11- Construct the results postprocessor class object &#39;post&#39; &quot;&quot;&quot;</span>
    <span class="n">post</span> <span class="o">=</span> <span class="n">PostMADS</span><span class="p">(</span><span class="n">x_incumbent</span><span class="o">=</span><span class="p">[</span><span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="p">],</span> <span class="n">xmin</span><span class="o">=</span><span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">poll_dirs</span><span class="o">=</span><span class="p">[</span><span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="p">])</span>
    <span class="n">post</span><span class="o">.</span><span class="n">psize</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize</span><span class="p">)</span>
    <span class="n">post</span><span class="o">.</span><span class="n">bb_eval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">bb_handle</span><span class="o">.</span><span class="n">bb_eval</span><span class="p">)</span>
    <span class="n">post</span><span class="o">.</span><span class="n">iter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iteration</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot; Note: printing the post will print a results row</span>
<span class="sd">     within the results table shown in Python console if the</span>
<span class="sd">    &#39;display&#39; option is true &quot;&quot;&quot;</span>
    <span class="c1"># if options.display:</span>
    <span class="c1">#     print(post)</span>
    <span class="sd">&quot;&quot;&quot; 12- Add the starting point hash value to the cache memory &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">store_cache</span><span class="p">:</span>
      <span class="n">poll</span><span class="o">.</span><span class="n">hashtable</span><span class="o">.</span><span class="n">hash_id</span> <span class="o">=</span> <span class="n">x_start</span>
    <span class="sd">&quot;&quot;&quot; 13- Initialize the output results file object  &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">Output</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">post_dir</span><span class="p">,</span> <span class="n">vnames</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;End of the evaluation of the starting points&quot;</span><span class="p">)</span>
    <span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">x_start</span><span class="p">,</span> <span class="n">poll</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">post</span><span class="p">,</span> <span class="n">out</span></div></div>


<div class="viewcode-block" id="Output"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Output">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Output</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot; Results output file decorator</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span>
  <span class="n">vnames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
  <span class="n">file_writer</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">field_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
      <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Iter no.&#39;</span><span class="p">,</span> <span class="s1">&#39;Eval no.&#39;</span><span class="p">,</span> <span class="s1">&#39;poll_size&#39;</span><span class="p">,</span> <span class="s1">&#39;hmin&#39;</span><span class="p">,</span> <span class="s1">&#39;fmin&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnames</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">+</span> <span class="s1">&#39;/MADS.csv&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">file_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">file_writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>

<div class="viewcode-block" id="Output.add_row"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Output.add_row">[docs]</a>  <span class="k">def</span> <span class="nf">add_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterno</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">evalno</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">poll_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">h</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
    <span class="n">row</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Iter no.&#39;</span><span class="p">:</span> <span class="n">iterno</span><span class="p">,</span> <span class="s1">&#39;Eval no.&#39;</span><span class="p">:</span> <span class="n">evalno</span><span class="p">,</span>
         <span class="s1">&#39;poll_size&#39;</span><span class="p">:</span> <span class="n">poll_size</span><span class="p">,</span> <span class="s1">&#39;hmin&#39;</span><span class="p">:</span> <span class="n">h</span><span class="p">,</span> <span class="s1">&#39;fmin&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="p">)):</span>
      <span class="n">row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">5</span><span class="p">]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;MADS.csv&#39;</span><span class="p">)),</span>
          <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">File</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">file_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">File</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">file_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PostMADS"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.PostMADS">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PostMADS</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot; Results postprocessor</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">x_incumbent</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span>
  <span class="n">xmin</span><span class="p">:</span> <span class="n">Point</span>
  <span class="n">coords</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Point</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
  <span class="n">poll_dirs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
  <span class="nb">iter</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
  <span class="n">bb_eval</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
  <span class="n">psize</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

<div class="viewcode-block" id="PostMADS.output_results"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.PostMADS.output_results">[docs]</a>  <span class="k">def</span> <span class="nf">output_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="n">Output</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create a results file from the saved cache&quot;&quot;&quot;</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">poll_dirs</span><span class="p">:</span>
      <span class="n">out</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">iterno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iter</span><span class="p">[</span><span class="n">counter</span><span class="p">],</span>
            <span class="n">evalno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bb_eval</span><span class="p">[</span><span class="n">counter</span><span class="p">],</span> <span class="n">poll_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">psize</span><span class="p">[</span><span class="n">counter</span><span class="p">],</span>
            <span class="n">h</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">,</span>
            <span class="n">f</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>
      <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="PostMADS.output_coordinates"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.PostMADS.output_coordinates">[docs]</a>  <span class="k">def</span> <span class="nf">output_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="n">Output</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Save spinners in a json file &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">file_path</span> <span class="o">+</span> <span class="s2">&quot;/coords.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
      <span class="n">dict_out</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">ob</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">entry</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">ib</span><span class="o">.</span><span class="n">coordinates</span> <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="n">ob</span><span class="p">]</span>
        <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;iter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ii</span>
        <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;coord&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
        <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;x_incumbent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_incumbent</span><span class="p">[</span><span class="n">ii</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coordinates</span>
        <span class="n">dict_out</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>
        <span class="k">del</span> <span class="n">entry</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dict_out</span><span class="p">,</span> <span class="n">json_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

  <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;iteration= &quot;</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iter</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="s2">&quot;bbeval= &quot;</span><span class="si">}</span><span class="s1"> &#39;</span> \
         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bb_eval</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="s2">&quot;psize= &quot;</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">psize</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">, &#39;</span> \
         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;hmin = &quot;</span><span class="si">}</span><span class="s1"> &#39;</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">h</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="s2">&quot;fmin = &quot;</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">f</span><span class="si">}</span><span class="s1">&#39;</span>

  <span class="k">def</span> <span class="nf">__add_to_cache__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Point</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_incumbent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
  <span class="sd">&quot;&quot;&quot; Otho-MADS main algorithm &quot;&quot;&quot;</span>
  <span class="c1"># TODO: add more checks for more defensive code</span>

  <span class="sd">&quot;&quot;&quot; Parse the parameters files &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
      <span class="n">_</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="k">if</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s2">&quot;.json&quot;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
          <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;invalid json file: &#39;</span> <span class="o">+</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The input file </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> is not a JSON dictionary. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Currently, OMADS supports JSON files solely!&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Couldn&#39;t find </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> file!&quot;</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;The first input argument couldn&#39;t be recognized. &quot;</span>
            <span class="s2">&quot;It should be either a dictionary object or a JSON file that holds &quot;</span>
            <span class="s2">&quot;the required input parameters.&quot;</span><span class="p">)</span>

  <span class="sd">&quot;&quot;&quot; Run preprocessor for the setup of</span>
<span class="sd">   the optimization problem and for the initialization</span>
<span class="sd">  of optimization process &quot;&quot;&quot;</span>
  <span class="n">iteration</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">poll</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">post</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="n">PreMADS</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">initialize_from_dict</span><span class="p">()</span>

  <span class="sd">&quot;&quot;&quot; Set the random seed for results reproducibility &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

  <span class="sd">&quot;&quot;&quot; Start the count down for calculating the runtime indicator &quot;&quot;&quot;</span>
  <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
  <span class="n">peval</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot; Create the set of poll directions &quot;&quot;&quot;</span>
    <span class="n">hhm</span> <span class="o">=</span> <span class="n">poll</span><span class="o">.</span><span class="n">create_housholder</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">rich_direction</span><span class="p">)</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">create_poll_set</span><span class="p">(</span><span class="n">hhm</span><span class="o">=</span><span class="n">hhm</span><span class="p">,</span>
               <span class="n">ub</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">ub</span><span class="p">,</span>
               <span class="n">lb</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">lb</span><span class="p">,</span> <span class="n">it</span><span class="o">=</span><span class="n">iteration</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot; Save current poll directions and incumbent solution</span>
<span class="sd">     so they can be saved later in the post dir &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">save_coordinates</span><span class="p">:</span>
      <span class="n">post</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">poll_dirs</span><span class="p">)</span>
      <span class="n">post</span><span class="o">.</span><span class="n">x_incumbent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot; Reset success boolean &quot;&quot;&quot;</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="sd">&quot;&quot;&quot; Reset the BB output &quot;&quot;&quot;</span>
    <span class="n">poll</span><span class="o">.</span><span class="n">bb_output</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">xt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="sd">&quot;&quot;&quot; Serial evaluation for points in the poll set &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">parallel_mode</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">poll_dirs</span><span class="p">)):</span>
        <span class="n">peval</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">poll</span><span class="o">.</span><span class="n">terminate</span><span class="p">:</span>
          <span class="k">break</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">poll</span><span class="o">.</span><span class="n">eval_poll_point</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
        <span class="n">xt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
          <span class="n">post</span><span class="o">.</span><span class="n">bb_eval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">bb_handle</span><span class="o">.</span><span class="n">bb_eval</span><span class="p">)</span>
          <span class="n">post</span><span class="o">.</span><span class="n">iter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iteration</span><span class="p">)</span>
          <span class="n">post</span><span class="o">.</span><span class="n">psize</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize</span><span class="p">)</span>
          <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">save_results</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">save_all_best</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">f</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
              <span class="k">continue</span>
            <span class="n">post</span><span class="o">.</span><span class="n">poll_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">poll_dirs</span><span class="p">[</span><span class="n">it</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">continue</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="n">poll</span><span class="o">.</span><span class="n">point_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
      <span class="sd">&quot;&quot;&quot; Parallel evaluation for points in the poll set &quot;&quot;&quot;</span>
      <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">np</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">eval_poll_point</span><span class="p">,</span>
                       <span class="n">it</span><span class="p">)</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">poll_dirs</span><span class="p">))]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
          <span class="c1"># if f.result()[0]:</span>
          <span class="c1">#     executor.shutdown(wait=False)</span>
          <span class="c1"># else:</span>
          <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">save_results</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">save_all_best</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="mi">3</span><span class="p">]:</span>
              <span class="k">continue</span>
            <span class="n">peval</span> <span class="o">=</span> <span class="n">peval</span> <span class="o">+</span><span class="mi">1</span>
            <span class="n">poll</span><span class="o">.</span><span class="n">bb_eval</span> <span class="o">=</span> <span class="n">peval</span>
            <span class="n">post</span><span class="o">.</span><span class="n">bb_eval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">peval</span><span class="p">)</span>
            <span class="n">post</span><span class="o">.</span><span class="n">iter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iteration</span><span class="p">)</span>
            <span class="n">post</span><span class="o">.</span><span class="n">poll_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">poll_dirs</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">post</span><span class="o">.</span><span class="n">psize</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
          <span class="n">xt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">poll</span><span class="o">.</span><span class="n">master_updates</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">peval</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot; Update the xmin in post&quot;&quot;&quot;</span>
    <span class="n">post</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot; Updates &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">poll</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
      <span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">poll</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">poll</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">options</span><span class="o">.</span><span class="n">tol</span> <span class="ow">or</span> <span class="n">poll</span><span class="o">.</span><span class="n">bb_eval</span> <span class="o">&gt;=</span> <span class="n">options</span><span class="o">.</span><span class="n">budget</span> <span class="ow">or</span> <span class="n">poll</span><span class="o">.</span><span class="n">terminate</span><span class="p">:</span>
      <span class="k">break</span>
    <span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>

  <span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

  <span class="sd">&quot;&quot;&quot; If benchmarking, then populate the results in the benchmarking output report &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">toy</span><span class="o">.</span><span class="n">Run</span><span class="p">):</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">toy</span><span class="o">.</span><span class="n">Run</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">test_suite</span> <span class="o">==</span> <span class="s2">&quot;uncon&quot;</span><span class="p">:</span>
      <span class="n">ncon</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">ncon</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">bb_output</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">bb_output</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">b</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">poll</span><span class="o">.</span><span class="n">bb_handle</span><span class="o">.</span><span class="n">blackbox</span><span class="p">,</span>
            <span class="n">run_index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
            <span class="n">nv</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">baseline</span><span class="p">),</span>
            <span class="n">nc</span><span class="o">=</span><span class="n">ncon</span><span class="p">,</span>
            <span class="n">nb_success</span><span class="o">=</span><span class="n">poll</span><span class="o">.</span><span class="n">nb_success</span><span class="p">,</span>
            <span class="n">it</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
            <span class="n">BBEVAL</span><span class="o">=</span><span class="n">poll</span><span class="o">.</span><span class="n">bb_eval</span><span class="p">,</span>
            <span class="n">runtime</span><span class="o">=</span><span class="n">toc</span> <span class="o">-</span> <span class="n">tic</span><span class="p">,</span>
            <span class="n">feval</span><span class="o">=</span><span class="n">poll</span><span class="o">.</span><span class="n">bb_handle</span><span class="o">.</span><span class="n">bb_eval</span><span class="p">,</span>
            <span class="n">hmin</span><span class="o">=</span><span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">h</span><span class="p">,</span>
            <span class="n">fmin</span><span class="o">=</span><span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">poll</span><span class="o">.</span><span class="n">bb_handle</span><span class="o">.</span><span class="n">blackbox</span><span class="si">}</span><span class="s2">: fmin = </span><span class="si">{</span><span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">f</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> , hmin= </span><span class="si">{</span><span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">h</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

  <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">toy</span><span class="o">.</span><span class="n">Run</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Could not find &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; in the internal BM suite.&quot;</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">save_results</span><span class="p">:</span>
    <span class="n">post</span><span class="o">.</span><span class="n">output_results</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; end of orthogonal MADS &quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Final objective value: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, hmin= &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>

  <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">save_coordinates</span><span class="p">:</span>
    <span class="n">post</span><span class="o">.</span><span class="n">output_coordinates</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ---Run Summary---&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Run completed in </span><span class="si">{</span><span class="n">toc</span> <span class="o">-</span> <span class="n">tic</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Random numbers generator&#39;s seed </span><span class="si">{</span><span class="n">options</span><span class="o">.</span><span class="n">seed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; xmin = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; hmin = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; fmin = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">f</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; #bb_eval = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">bb_eval</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; #iteration = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">iteration</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; nb_success = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">nb_success</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; psize = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; psize_success = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize_success</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; psize_max = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize_max</span><span class="p">))</span>
  <span class="n">output</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xmin&quot;</span><span class="p">:</span> <span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">coordinates</span><span class="p">,</span>
                <span class="s2">&quot;fmin&quot;</span><span class="p">:</span> <span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                <span class="s2">&quot;hmin&quot;</span><span class="p">:</span> <span class="n">poll</span><span class="o">.</span><span class="n">xmin</span><span class="o">.</span><span class="n">h</span><span class="p">,</span>
                <span class="s2">&quot;nbb_evals&quot;</span> <span class="p">:</span> <span class="n">poll</span><span class="o">.</span><span class="n">bb_eval</span><span class="p">,</span>
                <span class="s2">&quot;niterations&quot;</span> <span class="p">:</span> <span class="n">iteration</span><span class="p">,</span>
                <span class="s2">&quot;nb_success&quot;</span><span class="p">:</span> <span class="n">poll</span><span class="o">.</span><span class="n">nb_success</span><span class="p">,</span>
                <span class="s2">&quot;psize&quot;</span><span class="p">:</span> <span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize</span><span class="p">,</span>
                <span class="s2">&quot;psuccess&quot;</span><span class="p">:</span> <span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize_success</span><span class="p">,</span>
                <span class="s2">&quot;pmax&quot;</span><span class="p">:</span> <span class="n">poll</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">psize_max</span><span class="p">}</span>

  <span class="k">return</span> <span class="n">output</span></div>

<div class="viewcode-block" id="rosen"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.rosen">[docs]</a><span class="k">def</span> <span class="nf">rosen</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="o">*</span><span class="n">argv</span><span class="p">):</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
  <span class="k">return</span> <span class="n">y</span></div>

<div class="viewcode-block" id="alpine"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.alpine">[docs]</a><span class="k">def</span> <span class="nf">alpine</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
  <span class="k">return</span> <span class="n">y</span></div>

<div class="viewcode-block" id="Ackley3"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.Ackley3">[docs]</a><span class="k">def</span> <span class="nf">Ackley3</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="p">[</span><span class="o">-</span><span class="mi">200</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]</span></div>

<div class="viewcode-block" id="eggHolder"><a class="viewcode-back" href="../../OMADS.html#OMADS.POLL.eggHolder">[docs]</a><span class="k">def</span> <span class="nf">eggHolder</span><span class="p">(</span><span class="n">individual</span><span class="p">):</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">individual</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">individual</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mf">47.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mf">47.0</span><span class="p">))))</span> <span class="o">-</span> <span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mf">47.0</span><span class="p">)))))</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">freeze_support</span><span class="p">()</span>
    <span class="n">p_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot; Check if an input argument is provided&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">p_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">main</span><span class="p">(</span><span class="n">p_file</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">p_file</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p_file</span><span class="p">)):</span>
      <span class="n">main</span><span class="p">(</span><span class="n">p_file</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">p_file</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Undefined input args.&quot;</span>
              <span class="s2">&quot; Please specify an appropriate input (parameters) jason file&quot;</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Ahmed Bayoumy, Read the Docs, Inc. &amp; contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>